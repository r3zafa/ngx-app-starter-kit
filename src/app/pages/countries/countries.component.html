@if (countriesStore.error()) {
<mat-card class="error-card">
    <mat-card-content>
        <p class="error">Error loading countries: {{ countriesStore.error() }}</p>
    </mat-card-content>
</mat-card>
}

<h1>Countries</h1>

<div class="debug-info">
    <p>Selected Regions: {{ countriesStore.selectedRegions().join(', ') || 'All Regions' }}</p>
    <p>Sorting by: {{ countriesStore.sortOption() }}</p>
    <p>Showing {{ countriesStore.filteredCountries().length }} of {{ countriesStore.countries().length }} countries</p>
</div>

<div class="country-filter-grid">
    <!-- Search input -->
    <mat-form-field appearance="outline">
        <mat-label>Search Countries</mat-label>
        <input matInput type="text" (input)="handleSearch($event)" placeholder="Search by name or capital">
    </mat-form-field>

    <!-- Region selector -->
    <mat-form-field appearance="outline">
        <mat-label>Filter by Regions</mat-label>
        <mat-select multiple (selectionChange)="onRegionsChange($event.value)"
            [value]="countriesStore.selectedRegions()">
            @for (region of countriesStore.regionsForSelect(); track region) {
            <mat-option [value]="region === 'All Regions' ? '' : region">
                {{ region }}
            </mat-option>
            }
        </mat-select>
    </mat-form-field>

    <!-- Sort selector -->
    <mat-form-field appearance="outline">
        <mat-label>Sort By</mat-label>
        <mat-select (selectionChange)="onSortChange($event.value)" 
                   [value]="countriesStore.sortOption()">
            <mat-option value="alphabetical">A → Z</mat-option>
            <mat-option value="reverse-alphabetical">Z → A</mat-option>
            <mat-option value="region">By Region</mat-option>
        </mat-select>
    </mat-form-field>
</div>

@if (countriesStore.loading()) {
<div class="loading-spinner">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Loading countries...</p>
</div>
}

<div class="country-grid">
    @for (country of countriesStore.sortedCountries(); track country.cca3) {
    <app-country-card [country]="country" />
    }
</div>